// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "history"]
}

model Entity {
  id   Int    @id @default(autoincrement())
  name String
  logo String?
  complaints Complaint[]

  @@map("entities")
  @@schema("public")
}

model Complaint {
  id      Int    @id @default(autoincrement())
  entity_id Int
  description String
  creation_date DateTime @default(now())
  state ComplaintState @default(OPEN)
  entity  Entity @relation(fields: [entity_id], references: [id])
  comments Comment[]

  @@map("complaints")
  @@schema("public")
}

enum ComplaintState {
  OPEN
  UNDER_REVIEW
  CLOSED
  DELETED
  
  @@schema("public")
}

model Comment {
  id          Int      @id @default(autoincrement())
  complaint_id Int
  content     String
  creation_date DateTime @default(now())
  complaint   Complaint @relation(fields: [complaint_id], references: [id])

  @@map("comments")
  @@schema("public")
}

model ComplaintHistory {
  id           Int      @id @default(autoincrement())
  complaint_id Int
  description  String
  prev_state   ComplaintState
  new_state    ComplaintState
  change_date  DateTime @default(now())

  @@map("complaint_history")
  @@schema("history")
}